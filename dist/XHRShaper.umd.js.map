{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 21b6a60d166d23537e4b","webpack:///./src/xhr-proxy.js","webpack:///./src/xhr.js","webpack:///./index.js","webpack:///./src/cache.js","webpack:///./src/setup-cached-xhr.js","webpack:///./src/setup-throttled-xhr.js","webpack:///./src/shaper.js"],"names":["XMLHttpRequest","window","XHRProxy","_xhr","abort","method","url","async","user","password","open","data","send","header","value","setRequestHeader","getResponseHeader","mimeType","overrideMimeType","getAllResponseHeaders","type","listener","optionsOrUseCapture","wantsUntrusted","addEventListener","removeEventListener","event","dispatchEvent","readyState","response","responseText","responseXML","responseURL","status","statusText","upload","enabled","withCredentials","responseType","timeout","fn","onload","onloadstart","onloadend","onabort","onerror","onprogress","ontimeout","onreadystatechange","DEBUG","PASSTHROUGH_EVENTS","createListenerWrapper","dispatchedEventsList","push","propagated","XHR","_cacheInstance","instance","_shaper","_listenersMap","Map","_dispatchedEventsList","_response","_responseText","_responseXML","_headers","_readyState","_caching","_cacheHit","_cacheWrite","_onSend","console","log","put","setTimeout","filter","dispatchedEvent","forEach","cachedResource","onSend","_dispatchWrappedEventType","dataText","dataXML","_headersAll","headers","e","warn","includes","listenerWrapper","set","get","delete","Error","_handleCacheHitOnSend","enable","_onloadend","_onload","_onreadystatechange","_onprogress","useGlobal","global","module","exports","DEFAULT_ALLOW_UPDATES","MAX_CACHE_SIZE_BYTES","cache","bytesRead","bytesWritten","misses","hits","allowUpdates","errorOnOverflow","uri","onlyData","resource","has","accessedAt","Date","now","byteLength","headersAll","createdAt","totalSize","countBytes","purgeOldest","purgeByUri","purgeAll","clear","purgeNotAccessedSince","timeMillisSince","purgeCreatedBefore","timestamp","count","prop","i","oldest","reduce","reduceFn","accuInit","accu","bind","sumDataProperty","field","getInfo","setupCachedXhr","xhr","xhrProxy","cacheInstance","XHRReadyStates","UNSENT","OPENED","HEADERS_RECEIVED","LOADING","DONE","setupThrottledXhr","shaper","openedTs","headersTs","loadingTs","doneTs","loaded","total","currentBitrateKpbs","progressEvents","progressTimer","lastProgressEvent","loadEndEvent","loadEvent","done","_setupWrappedResponseData","triggerStateChange","latency","delay1","delay2","_setupWrappedHeaders","minLatency","maxBandwidth","clearTimeout","length","Math","max","triggerProgress","duration","delay","Shaper","_maxBandwidth","Infinity","_minLatency","_minProgressEvents","_randomness","Object","defineProperty","min","val","minProgressEvents","randomness"],"mappings":"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","file":"XHRShaper.umd.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"XHRShaper\"] = factory();\n\telse\n\t\troot[\"XHRShaper\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 21b6a60d166d23537e4b","// See https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n\nconst XMLHttpRequest = window.XMLHttpRequest;\n\nclass XHRProxy {\n\n    constructor() {\n        this._xhr = new XMLHttpRequest();\n    }\n\n    // methods\n\n    abort() {\n        return this._xhr.abort();\n    }\n    open(method, url, async, user, password) {\n        return this._xhr.open(method, url, async, user, password); \n    }\n    send(data) {\n        return this._xhr.send(data);   \n    }\n    setRequestHeader(header, value) {\n        return this._xhr.setRequestHeader(header, value);\n    }\n    getResponseHeader(header) {\n        return this._xhr.getResponseHeader(header);\n    }\n    overrideMimeType(mimeType) {\n        return this._xhr.overrideMimeType(mimeType);\n    }\n    getAllResponseHeaders() {\n        return this._xhr.getAllResponseHeaders();\n    }\n\n    addEventListener(type, listener, optionsOrUseCapture, wantsUntrusted) {\n        return this._xhr.addEventListener(type, listener, optionsOrUseCapture, wantsUntrusted);\n    }\n    removeEventListener(type, listener, optionsOrUseCapture) {\n        return this._xhr.removeEventListener(type, listener, optionsOrUseCapture);\n    }\n    dispatchEvent(event) {\n        return this._xhr.dispatchEvent(event);\n    }\n\n    // Read-only properties\n\n    get readyState() {\n        return this._xhr.readyState;\n    }\n    get response() {\n        return this._xhr.response;\n    }\n    get responseText() {\n        return this._xhr.responseText;   \n    }\n    get responseXML() {\n        return this._xhr.responseXML;\n    }\n    get responseURL() {\n        return this._xhr.responseURL;\n    }\n    get status() {\n        return this._xhr.status;\n    }\n    get statusText() {\n        return this._xhr.statusText;\n    }\n    get upload() {\n        return this._xhr.upload;\n    }\n    \n    // R & W properties\n\n    set withCredentials(enabled) {\n        this._xhr.withCredentials = enabled;\n    }\n    get withCredentials() {\n        return this._xhr.withCredentials;\n    }\n\n    set responseType(responseType) {\n        this._xhr.responseType = responseType;\n    }\n    get responseType() {\n        return this._xhr.responseType;\n    }\n\n    set timeout(timeout) {\n        this._xhr.timeout = timeout;\n    }\n    get timeout() {\n        return this._xhr.timeout;\n    }\n\n    set onload(fn) {\n        this._xhr.onload = fn;\n    }\n    get onload() {\n        return this._xhr.onload;\n    }\n\n    set onloadstart(fn) {\n        this._xhr.onloadstart = fn;\n    }\n    get onloadstart() {\n        return this._xhr.onloadstart;\n    }    \n\n    set onloadend(fn) {\n        this._xhr.onloadend = fn;\n    }\n    get onloadend() {\n        return this._xhr.onloadend;\n    }\n\n    set onabort(fn) {\n        this._xhr.onabort = fn;\n    }\n    get onabort() {\n        return this._xhr.onabort;\n    }\n\n    set onerror(fn) {\n        this._xhr.onerror = fn;\n    }\n    get onerror() {\n        return this._xhr.onerror;\n    }\n\n    set onprogress(fn) {\n        this._xhr.onprogress = fn;\n    }\n    get onprogress() {\n        return this._xhr.onprogress;\n    }\n\n    set ontimeout(fn) {\n        this._xhr.ontimeout = fn;\n    }\n    get ontimeout() {\n        return this._xhr.ontimeout;\n    }\n\n    set onreadystatechange(fn) {\n        this._xhr.onreadystatechange = fn;\n    }\n    get onreadystatechange() {\n        return this._xhr.onreadystatechange;\n    } \n}\n\nexport default XHRProxy;\n\n\n// WEBPACK FOOTER //\n// ./src/xhr-proxy.js","import XHRProxy from './xhr-proxy';\nimport Shaper from './shaper';\nimport setupThrottledXhr from './setup-throttled-xhr';\nimport setupCachedXhr from './setup-cached-xhr';\nimport cache from './cache';\n\nconst DEBUG = false;\n\nconst PASSTHROUGH_EVENTS = ['loadstart', 'timeout', 'abort', 'error'];\n\nconst createListenerWrapper = (type, listener, dispatchedEventsList) => {\n    return (event) => {\n        dispatchedEventsList.push({type, listener, event, propagated: false});\n    };\n}\n\nclass XHR extends XHRProxy {\n\n    static get Shaper() {\n        return Shaper;\n    }\n\n    static get cache() {\n        return cache;\n    }\n\n    constructor() {\n        super();\n\n        this._cacheInstance = cache.instance;\n        this._shaper = new Shaper();\n        this._listenersMap = new Map();\n        this._dispatchedEventsList = [];\n        this._response = null;\n        this._responseText = null;\n        this._responseXML = null;\n        this._headers = null;\n        this._readyState = 0;\n        this._caching = false;\n        this._cacheHit = false;\n        this._cacheWrite = true;\n        this._onSend = null;\n\n        this.addEventListener('loadend', () => {\n            if (this._caching && this._cacheWrite) {\n                DEBUG && console.log('CACHE WRITE:', this._xhr.responseURL);\n                this._cacheInstance.put(\n                    this._xhr.responseURL, \n                    this._response, \n                    this._responseText,\n                    this._responseXML,\n                    null,\n                    this._xhr.getAllResponseHeaders()\n                );\n            }\n        });\n\n        setupThrottledXhr(this._xhr, this);\n    }\n\n    get caching() {\n       return this._caching;\n    }\n\n    set caching(enabled) {\n        this._caching = enabled;\n    }\n\n    set cacheInstance(instance) {\n        this._cacheInstance = instance;\n    }\n\n    get cacheInstance() {\n        return this._cacheInstance;\n    }\n\n    get isCacheHit() {\n        return this._cacheHit;\n    }\n\n    set cacheWriteEnabled(enable) {\n        this._cacheWrite = enable;\n    }\n\n    get enableCacheWrite() {\n        return this._cacheWrite;\n    }\n\n    get shaper() {\n        return this._shaper;\n    }\n\n    _dispatchWrappedEventType(type) {\n        // it needs to run on the next tick since this is actually\n        // triggered from our throttler listeners on the proxy's inner XHR \n        setTimeout(() => {\n            this._dispatchedEventsList\n                .filter((dispatchedEvent) => (dispatchedEvent.type === type && !dispatchedEvent.propagated))\n                .forEach((dispatchedEvent) => {\n                    dispatchedEvent.propagated = true;\n                    dispatchedEvent.listener(dispatchedEvent.event);\n                });         \n        }, 0);\n    }\n\n    _handleCacheHitOnSend(cachedResource) {\n        this._readyState = 1;\n        this._cacheHit = true;\n\n        const onSend = () => {\n            setTimeout(() => {\n                this._readyState = 2;\n                this.onreadystatechange && this.onreadystatechange();\n                this._dispatchWrappedEventType('readystatechange');\n                this._readyState = 3;\n                this.onreadystatechange && this.onreadystatechange();\n                this._dispatchWrappedEventType('readystatechange');\n                this.onloadstart && this.onloadstart();\n                this._dispatchWrappedEventType('loadstart');\n                this._response = cachedResource.data;\n                this._responseText = cachedResource.dataText;\n                this._responseXML = cachedResource.dataXML;\n                this._headersAll = cachedResource.headers;\n                this._readyState = 4;\n                this.onreadystatechange && this.onreadystatechange();\n                this._dispatchWrappedEventType('readystatechange');\n                this.onreadystatechange && this.onreadystatechange();\n                this._dispatchWrappedEventType('readystatechange');\n                this.onload && this.onload();\n                this._dispatchWrappedEventType('load');\n                this.onloadend && this.onloadend();\n                this._dispatchWrappedEventType('loadend');\n            }, 0);            \n        };\n        this._onSend = onSend;\n    }\n\n    _setupWrappedResponseData() {\n        try { \n            this._response = this._xhr.response; \n        } catch(e) {\n            DEBUG && console.warn(e)\n        }\n        try { \n            this._responseText = this._xhr.responseText; \n        } catch(e) {\n            DEBUG && console.warn(e)\n        }\n        try { \n            this._responseXML = this._xhr.responseXML; \n        } catch(e) {\n            DEBUG && console.warn(e)\n        }\n    }\n\n    _setupWrappedHeaders() {\n        try { this._headersAll = this._xhr.getAllResponseHeaders(); } catch(e) {}\n    }\n\n    addEventListener(type, listener, optionsOrUseCapture, wantsUntrusted) {\n\n        if (PASSTHROUGH_EVENTS.includes(type)) {\n            return super.addEventListener(type, listener, optionsOrUseCapture, wantsUntrusted);\n        }\n\n        const listenerWrapper = createListenerWrapper(type, listener, this._dispatchedEventsList);\n        this._listenersMap.set(listener, listenerWrapper);\n        return super.addEventListener(type, listenerWrapper, optionsOrUseCapture, wantsUntrusted);\n    }\n\n    removeEventListener(type, listener, optionsOrUseCapture) {\n\n        if (PASSTHROUGH_EVENTS.includes(type)) {\n            return super.removeEventListener(type, listener, optionsOrUseCapture)\n        }\n\n        const listenerWrapper = this._listenersMap.get(listener);\n        if (!listenerWrapper) {\n            return;\n        }\n        this._listenersMap.delete(listener);\n        return super.removeEventListener(type, listenerWrapper, optionsOrUseCapture);\n    }\n\n    open(method, url, async, user, password) {\n\n        if (this._caching) {\n            if (!this._cacheInstance) {\n                throw new Error('no cache setup');\n            }\n            DEBUG && console.log('CACHE GET:', url);\n            const cachedResource = this._cacheInstance.get(url, false);\n            if (cachedResource) {\n\n                DEBUG && console.log('CACHE HIT');\n\n                this._handleCacheHitOnSend(cachedResource);\n            }\n        }\n\n        return super.open(method, url, async, user, password); \n    }\n\n    send(data) {\n        if (this._caching && this._cacheHit && this._onSend) {\n            return this._onSend();\n        }\n\n        return super.send(data); \n    }\n\n    getAllResponseHeaders() {\n        return this._headersAll;\n    }\n\n    get readyState() {\n        if (typeof this._readyState === 'number') {\n            return this._readyState;\n        }\n    }\n\n    set onloadend(fn) {\n        this._onloadend = fn;\n    }\n\n    get onloadend() {\n        return this._onloadend;\n    }\n\n    set onload(fn) {\n        this._onload = fn;\n    }\n\n    get onload() {\n        return this._onload;\n    }\n\n    set onreadystatechange(fn) {\n        this._onreadystatechange = fn;\n    }\n\n    get onreadystatechange() {\n        return this._onreadystatechange;\n    }\n\n    set onprogress(fn) {\n        this._onprogress = fn;\n    }\n\n    get onprogress() {\n        return this._onprogress;\n    }\n\n    get response() {\n        return this._response;\n    }\n    get responseText() {\n        return this._responseText;\n    }\n    get responseXML() {\n        return this._responseXML;\n    }\n}\n\nexport default XHR;\n\n\n// WEBPACK FOOTER //\n// ./src/xhr.js","import XHRProxy from './src/xhr-proxy';\nimport XHR from './src/xhr';\n\nfunction useGlobal() {\n    // Shim window/global XHR\n    var global = window || global;\n    // Overload native window constructor\n    global.XMLHttpRequest = XHR;\n}\n\nmodule.exports = {\n    XMLHttpRequest: XHR,\n    XHRProxy,\n    useGlobal\n};\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","const DEFAULT_ALLOW_UPDATES = false;\nconst MAX_CACHE_SIZE_BYTES = 1024 * 1e6; // 1024 Mbytes\n\nconst cache = new Map();\n\nlet bytesRead = 0;\nlet bytesWritten = 0;\nlet misses = 0;\nlet hits = 0;\n\nconst instance = {\n  allowUpdates: DEFAULT_ALLOW_UPDATES,\n  errorOnOverflow: false,\n  get: (uri, onlyData = true) => {\n    let resource;\n    if (!cache.has(uri)) {\n      misses++;\n      return null;\n    }\n    hits++;\n    resource = cache.get(uri);\n    resource.accessedAt = Date.now();\n    if (typeof resource.data.byteLength === 'number') {\n      bytesRead += resource.data.byteLength;\n    }\n    if (onlyData) {\n      return resource.data;\n    } else {\n      return resource;\n    }\n  },\n  put: (uri, data, dataText, dataXML, headers, headersAll) => {\n    if (!instance.allowUpdates && cache.has(uri)) {\n      throw new Error('Cache updates not allowed. Purge first! URI:', uri);\n    }\n    let createdAt = Date.now();\n    let accessedAt = null;\n    let resource = {\n      uri,\n      data,\n      dataText,\n      dataXML,\n      headers,\n      headersAll,\n      createdAt,\n      accessedAt\n    }\n    cache.set(uri, resource);\n    if (typeof resource.data.byteLength === 'number') {\n      bytesWritten += resource.data.byteLength;\n    }\n    let totalSize = instance.countBytes();\n    if (totalSize > MAX_CACHE_SIZE_BYTES) {\n      if (instance.errorOnOverflow) throw new Error('Cache exceeds max size, has', totalSize, 'bytes');\n      instance.purgeOldest();\n    }\n    return instance\n  },\n  purgeByUri: (uri) => {\n    return cache.delete(uri);\n  },\n  purgeAll: () => {\n    cache.clear();\n  },\n  purgeNotAccessedSince: (timeMillisSince) => {\n    let now = Date.now();\n    cache.forEach((resource, uri) => {\n      if (!resource.accessedAt // never accessed\n        || resource.accessedAt < now - timeMillisSince) \n      cache.delete(uri);\n    });\n  },\n  purgeCreatedBefore: (timestamp) => {\n    cache.forEach((resource, uri) => {\n      if (createdAt < timestamp) \n      cache.delete(uri);\n    });\n  },\n  purgeOldest: (type = 'accessed', count = 1) => {\n    let prop = type + 'At';\n    for (let i = 0; i < count; i++) {\n      let oldest = null;\n      cache.forEach((resource) => {\n        if (!oldest || resource[prop] < oldest[prop]) {\n          oldest = resource;\n        }\n      });\n      cache.delete(oldest.uri);\n    }\n  },\n  reduce: (reduceFn, accuInit = 0) => {\n    let accu = accuInit;\n    cache.forEach((resource, uri) => {\n      accu = reduceFn.bind(this)(accu, resource);\n    });\n    return accu;\n  },\n  sumDataProperty: (field) => {\n    return instance.reduce((accu, resource) => {\n      return accu + resource.data[field];\n    });\n  },\n  countBytes: () => {\n    return instance.sumDataProperty('byteLength');\n  }\n};\n\nconst getInfo = function() {\n  return {\n    bytesRead,\n    bytesWritten,\n    hits,\n    misses\n  }\n}\n\nexport default {\n  getInfo,\n  instance\n};\n\n\n// WEBPACK FOOTER //\n// ./src/cache.js","function setupCachedXhr(xhr, xhrProxy, cacheInstance) {\n    xhrProxy._cacheInstance = cacheInstance;\n}\n\nexport default setupCachedXhr;\n\n\n// WEBPACK FOOTER //\n// ./src/setup-cached-xhr.js","var XHRReadyStates = {\n    UNSENT: 0,\n    OPENED: 1,\n    HEADERS_RECEIVED: 2,\n    LOADING: 3,\n    DONE: 4\n};\n\nfunction setupThrottledXhr(xhr, xhrProxy) {\n\n    let {\n        shaper\n    } = xhrProxy;\n\n    let openedTs, headersTs, loadingTs, doneTs;\n    let loaded = 0;\n    let total = 0;\n    let currentBitrateKpbs;\n    let progressEvents = [];\n    let progressTimer = null;\n    let lastProgressEvent = false;\n    let loadEndEvent = null;\n    let loadEvent = null;\n    let done = false;\n\n    xhr.onloadend = function(event) {\n\n        let {\n            _onloadend\n        } = xhrProxy;\n\n        loadEndEvent = event;\n        if (done) {\n            _onloadend && _onloadend(event);\n            xhrProxy._dispatchWrappedEventType('loadend');\n        }\n    };\n\n    xhr.onload = function(event) {\n\n        let {\n            _onload \n        } = xhrProxy;\n\n        //console.log('native load');\n        loadEvent = event;\n        if (done && xhr.readyState === XHRReadyStates.DONE) {\n            xhrProxy._setupWrappedResponseData();\n            _onload && _onload(event);\n            xhrProxy._dispatchWrappedEventType('load');\n        }\n    };\n\n    xhr.onreadystatechange = function(event) {\n        const now = Date.now();\n        const {\n            _onreadystatechange,\n            _onprogress,\n            _onload,\n            _onloadend\n        } = xhrProxy;\n        const triggerStateChange = function(e, readyState) {\n            if (typeof readyState !== 'number') {\n                throw new Error('readyState should be a number');\n            }\n\n            xhrProxy._readyState = readyState;\n            _onreadystatechange && _onreadystatechange(e);\n            xhrProxy._dispatchWrappedEventType('readystatechange');\n        }\n\n        let latency;\n        let delay1 = 0; \n        let delay2 = 0;\n\n        switch (xhr.readyState) {\n            case 0: // UNSENT\n                triggerStateChange(event, XHRReadyStates.UNSENT);\n                break;\n            case 1: // OPENED\n                openedTs = now;\n                triggerStateChange(event, XHRReadyStates.OPENED);\n                break;\n            case 2: // HEADERS_RECEIVED\n                headersTs = now;\n                xhrProxy._setupWrappedHeaders();\n                triggerStateChange(event, XHRReadyStates.HEADERS_RECEIVED);\n                break;\n            case 3: // LOADING\n                loadingTs = now;\n                triggerStateChange(event, XHRReadyStates.LOADING);\n                break;\n            case 4: // DONE\n                doneTs = now;\n                latency = doneTs - openedTs;\n                if (latency < shaper.minLatency) {\n                    delay1 = shaper.minLatency - latency;\n                }\n                if (currentBitrateKpbs > shaper.maxBandwidth) {\n                    delay2 = (currentBitrateKpbs / shaper.maxBandwidth) * latency - latency;\n                }\n                if (delay1 || delay2) {\n                    setTimeout(function() {\n\n                        if (loaded === total && !lastProgressEvent) {\n                            clearTimeout(progressTimer);\n                            _onprogress && _onprogress(progressEvents[progressEvents.length - 1]);\n                            xhrProxy._dispatchWrappedEventType('progress');\n                        }\n\n                        triggerStateChange(event, XHRReadyStates.DONE);\n\n                        done = true;\n\n                        if (loadEvent) {\n                            xhrProxy._setupWrappedResponseData();\n                            _onload && _onload(loadEvent);\n                            xhrProxy._dispatchWrappedEventType('load');\n                            loadEvent = null;\n                        }\n\n                        if (loadEndEvent) {\n                            _onloadend && _onloadend(loadEndEvent);\n                            xhrProxy._dispatchWrappedEventType('loadend');\n                            loadEndEvent = null;\n                        }\n\n                    }, Math.max(delay1, delay2));\n                } else {\n                    //console.log('done, not delaying');\n                    done = true;\n                    xhrProxy._setupWrappedResponseData();\n                    triggerStateChange(event, XHRReadyStates.DONE);\n                }\n                break;\n        }\n    };\n\n    xhr.onprogress = function(event) {\n        const now = Date.now();\n        const {\n            _onprogress\n        } = xhrProxy;\n        const triggerProgress = function(e) {\n            if (loaded === total) {\n                lastProgressEvent = true;\n            }\n\n            _onprogress && _onprogress(e);\n            xhrProxy._dispatchWrappedEventType('progress');\n        }\n\n        let duration = now - openedTs;\n        let delay;\n\n        loaded = event.loaded;\n        total = event.total;\n        currentBitrateKpbs = 8 * loaded / duration; // kbps\n\n        if (currentBitrateKpbs > shaper.maxBandwidth) {\n            delay = (currentBitrateKpbs / shaper.maxBandwidth) * duration - duration;\n            progressEvents.push(event);\n            progressTimer = setTimeout(function() {\n                triggerProgress(event);\n            }, delay);\n            return;\n        }\n\n        triggerProgress(event);\n    };\n}\n\nexport default setupThrottledXhr;\n\n\n// WEBPACK FOOTER //\n// ./src/setup-throttled-xhr.js","var Shaper = function() {\n    var _maxBandwidth = Infinity;\n    var _minLatency = 0;\n    var _minProgressEvents = 0;\n    var _randomness = 0;\n\n    Object.defineProperty(this, \"maxBandwidth\", {\n        get: function() {\n            return Math.min(_maxBandwidth, Shaper.maxBandwidth);\n        },\n        set: function(val) { _maxBandwidth = val; }\n    });\n    Object.defineProperty(this, \"minLatency\", {\n        get: function() {\n            return Math.max(_minLatency, Shaper.minLatency);\n        },\n        set: function(val) { _minLatency = val; }\n    });\n    Object.defineProperty(this, \"minProgressEvents\", {\n        get: function() {\n            return Math.max(_minProgressEvents, Shaper.minProgressEvents);\n        },\n        set: function(val) { _minProgressEvents = val; }\n    });\n    Object.defineProperty(this, \"randomness\", {\n        get: function() {\n            return Math.max(_randomness, Shaper.randomness);\n        },\n        set: function(val) { _randomness = val; }\n    });\n};\n\nShaper.maxBandwidth = Infinity;\nShaper.minLatency = 0;\nShaper.minProgressEvents = 0;\nShaper.randomness = 0;\n\nmodule.exports = Shaper;\n\n\n// WEBPACK FOOTER //\n// ./src/shaper.js"],"sourceRoot":""}