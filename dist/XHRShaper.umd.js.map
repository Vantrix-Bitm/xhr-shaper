{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap ab5873f01d7819880541","webpack:///./src/xhr.js","webpack:///./src/throttled-xhr.js","webpack:///./index.js","webpack:///./src/init-throttled-xhr.js","webpack:///./src/shaper.js"],"names":["XMLHttpRequest","window","XHRProxy","_xhr","abort","method","url","async","user","password","open","data","send","header","value","setRequestHeader","getResponseHeader","mimeType","overrideMimeType","getAllResponseHeaders","type","dispatchEvent","handler","addEventListener","removeEventListener","readyState","response","responseText","responseXML","responseURL","status","statusText","upload","enabled","withCredentials","responseType","timeout","fn","onload","onloadstart","onloadend","onabort","onerror","onprogress","ontimeout","onreadystatechange","ThrottledXHR","_shaper","Error","_onloadend","_onload","_onreadystatechange","_onprogress","useGlobal","global","module","exports","XHR","initThrottledXhr","xhr","xhrProxy","shaper","openedTs","headersTs","loadingTs","doneTs","loaded","total","currentBitrateKpbs","progressEvents","progressTimer","lastProgressEvent","loadEndEvent","loadEvent","done","event","console","log","triggerStateChange","e","Date","now","delay1","delay2","latency","minLatency","maxBandwidth","setTimeout","clearTimeout","length","Math","max","triggerProgress","duration","delay","push","id","round","random","_id","Shaper","_maxBandwidth","Infinity","_minLatency","_minProgressEvents","_randomness","Object","defineProperty","get","min","set","val","minProgressEvents","randomness"],"mappings":"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","file":"XHRShaper.umd.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"XHRShaper\"] = factory();\n\telse\n\t\troot[\"XHRShaper\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ab5873f01d7819880541","// See https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n\nconst XMLHttpRequest = window.XMLHttpRequest;\n\nclass XHRProxy {\n\n    constructor() {\n        this._xhr = new XMLHttpRequest();\n    }\n\n    // methods\n\n    abort() {\n        return this._xhr.abort();\n    }\n    open(method, url, async, user, password) {\n        return this._xhr.open(method, url, async, user, password); \n    }\n    send(data) {\n        return this._xhr.send(data);   \n    }\n    setRequestHeader(header, value) {\n        return this._xhr.setRequestHeader(header, value);\n    }\n    getResponseHeader(header) {\n        return this._xhr.getResponseHeader(header);\n    }\n    overrideMimeType(mimeType) {\n        return this._xhr.overrideMimeType(mimeType);\n    }\n    getAllResponseHeaders() {\n        return this._xhr.getAllResponseHeaders();\n    }\n\n    dispatchEvent(type) {\n        return this._xhr.dispatchEvent(type);\n    }\n    addEventListener(type, handler) {\n        return this._xhr.addEventListener(type, handler);\n    }\n    removeEventListener(type, handler) {\n        return this._xhr.removeEventListener(type, handler);\n    }\n\n    // Read-only properties\n\n    get readyState() {\n        return this._xhr.readyState;\n    }\n    get response() {\n        return this._xhr.response;\n    }\n    get responseText() {\n        return this._xhr.responseText;   \n    }\n    get responseXML() {\n        return this._xhr.responseXML;\n    }\n    get responseURL() {\n        return this._xhr.responseURL;\n    }\n    get status() {\n        return this._xhr.status;\n    }\n    get statusText() {\n        return this._xhr.statusText;\n    }\n    get upload() {\n        return this._xhr.upload;\n    }\n    \n    // R & W properties\n\n    set withCredentials(enabled) {\n        this._xhr.withCredentials = enabled;\n    }\n    get withCredentials() {\n        return this._xhr.withCredentials;\n    }\n\n    set responseType(responseType) {\n        this._xhr.responseType = responseType;\n    }\n    get responseType() {\n        return this._xhr.responseType;\n    }\n\n    set timeout(timeout) {\n        this._xhr.timeout = timeout;\n    }\n    get timeout() {\n        return this._xhr.timeout;\n    }\n\n    set onload(fn) {\n        this._xhr.onload = fn;\n    }\n    get onload() {\n        return this._xhr.onload;\n    }\n\n    set onloadstart(fn) {\n        this._xhr.onloadstart = fn;\n    }\n    get onloadstart() {\n        return this._xhr.onloadstart;\n    }    \n\n    set onloadend(fn) {\n        this._xhr.onloadend = fn;\n    }\n    get onloadend() {\n        return this._xhr.onloadend;\n    }\n\n    set onabort(fn) {\n        this._xhr.onabort = fn;\n    }\n    get onabort() {\n        return this._xhr.onabort;\n    }\n\n    set onerror(fn) {\n        this._xhr.onerror = fn;\n    }\n    get onerror() {\n        return this._xhr.onerror;\n    }\n\n    set onprogress(fn) {\n        this._xhr.onprogress = fn;\n    }\n    get onprogress() {\n        return this._xhr.onprogress;\n    }\n\n    set ontimeout(fn) {\n        this._xhr.ontimeout = fn;\n    }\n    get ontimeout() {\n        return this._xhr.ontimeout;\n    }\n\n    set onreadystatechange(fn) {\n        this._xhr.onreadystatechange = fn;\n    }\n    get onreadystatechange() {\n        return this._xhr.onreadystatechange;\n    } \n}\n\nexport default XHRProxy;\n\n\n// WEBPACK FOOTER //\n// ./src/xhr.js","import XHRProxy from './xhr';\nimport Shaper from './shaper';\nimport initThrottledXhr from './init-throttled-xhr';\n\nclass ThrottledXHR extends XHRProxy {\n\n    static get Shaper() {\n        return Shaper;\n    }\n\n    constructor() {\n        super();\n        this._shaper = new Shaper();\n\n        initThrottledXhr(this._xhr, this);\n    }\n\n    addEventListener() {\n        throw new Error('EventTarget API not implemented');\n    }\n\n    removeEventListener() {\n        throw new Error('EventTarget API not implemented');\n    }\n\n    dispatchEvent() {\n        throw new Error('EventTarget API not implemented');\n    }\n\n    get shaper() {\n        return this._shaper;\n    }\n\n    set onloadend(fn) {\n        this._onloadend = fn;\n    }\n\n    get onloadend() {\n        return this._onloadend;\n    }\n\n    set onload(fn) {\n        this._onload = fn;\n    }\n\n    get onload() {\n        return this._onload;\n    }\n\n    set onreadystatechange(fn) {\n        this._onreadystatechange = fn;\n    }\n\n    get onreadystatechange() {\n        return this._onreadystatechange;\n    }\n\n    set onprogress(fn) {\n        this._onprogress = fn;\n    }\n\n    get onprogress() {\n        return this._onprogress;\n    }\n}\n\nexport default ThrottledXHR;\n\n\n// WEBPACK FOOTER //\n// ./src/throttled-xhr.js","import XHRProxy from './src/xhr';\nimport ThrottledXHR from './src/throttled-xhr';\n\nfunction useGlobal() {\n    // Shim window/global XHR\n    var global = window || global;\n    // Overload native window constructor\n    global.XMLHttpRequest = ThrottledXHR;\n}\n\nmodule.exports = {\n    XHRProxy,\n    XHR,\n    useGlobal\n};\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","function initThrottledXhr(xhr, xhrProxy) {\n\n    let {\n        shaper,\n        _onload, \n        _onloadend, \n        _onreadystatechange, \n        _onprogress\n    } = xhrProxy;\n\n    let openedTs, headersTs, loadingTs, doneTs;\n    let loaded = 0, total;\n    let currentBitrateKpbs;\n    let progressEvents = [];\n    let progressTimer;\n    let lastProgressEvent = false;\n    let loadEndEvent;\n    let loadEvent;\n    let done = false;\n\n    xhr.onloadend = function(event) {\n\n        let {\n            shaper,\n            _onload, \n            _onloadend, \n            _onreadystatechange, \n            _onprogress\n        } = xhrProxy;\n\n        console.log('native loadend');\n        loadEndEvent = event;\n        if (done && _onloadend) {\n            _onloadend(event);\n        }\n    };\n\n    xhr.onload = function(event) {\n\n        let {\n            shaper,\n            _onload, \n            _onloadend, \n            _onreadystatechange, \n            _onprogress\n        } = xhrProxy;\n\n        console.log('native load');\n        loadEvent = event;\n        if (done && _onload && xhr.readyState === 4) {\n            _onload(event);\n        }\n    };\n\n    xhr.onreadystatechange = function(event) {\n\n        let {\n            shaper,\n            _onload, \n            _onloadend, \n            _onreadystatechange, \n            _onprogress\n        } = xhrProxy;\n\n        function triggerStateChange(e) {\n            if (_onreadystatechange) {\n                _onreadystatechange(e);\n            }\n        }\n\n        switch (xhr.readyState) {\n            case 0: // UNSENT\n                triggerStateChange(event);\n                break;\n            case 1: // OPENED\n                openedTs = Date.now();\n                triggerStateChange(event);\n                break;\n            case 2: // HEADERS_RECEIVE\n                headersTs = Date.now();\n                triggerStateChange(event);\n                break;\n            case 3: // LOADING\n                loadingTs = Date.now();\n                triggerStateChange(event);\n                break;\n            case 4: // DONE\n                let delay1 = 0, delay2 = 0;\n                doneTs = Date.now();\n                let latency = doneTs - openedTs;\n                if (latency < shaper.minLatency) {\n                    delay1 = shaper.minLatency - latency;\n                }\n                if (currentBitrateKpbs > shaper.maxBandwidth) {\n                    delay2 = (currentBitrateKpbs / shaper.maxBandwidth) * latency - latency;\n                }\n                if (delay1 || delay2) {\n                    setTimeout(function() {\n\n                        if (loaded === total && !lastProgressEvent) {\n                            clearTimeout(progressTimer);\n                            _onprogress(progressEvents[progressEvents.length - 1]);\n                        }\n\n                        triggerStateChange(event);\n\n                        done = true;\n\n                        if (loadEvent && _onload) {\n                            _onload(loadEvent);\n                            loadEvent = null;\n                        }\n\n                        if (loadEndEvent && _onloadend) {\n                            _onloadend(loadEndEvent);\n                            loadEndEvent = null;\n                        }\n\n                    }, Math.max(delay1, delay2));\n                } else {\n                    console.log('done, not delaying');\n                    done = true;\n                    triggerStateChange(event);\n                }\n                break;\n        }\n    };\n\n    xhr.onprogress = function(event) {\n\n        let {\n            shaper,\n            _onload, \n            _onloadend, \n            _onreadystatechange, \n            _onprogress\n        } = xhrProxy;\n\n        function triggerProgress(e) {\n\n            if (loaded === total) {\n                lastProgressEvent = true;\n            }\n\n            if (_onprogress) {\n                _onprogress(e);\n            }\n        }\n\n        let now = Date.now();\n        let duration = now - openedTs;\n        let delay;\n\n        loaded = event.loaded;\n        total = event.total;\n        currentBitrateKpbs = 8 * loaded / duration; // kbps\n\n        // console.log('current bitrate: ' + Math.round(currentBitrateKpbs) + ' kbps');\n\n        if (currentBitrateKpbs > shaper.maxBandwidth) {\n            delay = (currentBitrateKpbs / shaper.maxBandwidth) * duration - duration;\n            progressEvents.push(event);\n            // console.log('delaying progress event by ' + Math.round(delay) + ' ms');\n            progressTimer = setTimeout(function() {\n                triggerProgress(event);\n            }, delay);\n            return;\n        }\n\n        triggerProgress(event);\n    };\n\n    let id = Math.round(Math.random() * 1e6);\n\n    xhr._id = id;\n    xhrProxy._id = id;\n}\n\nexport default initThrottledXhr;\n\n\n// WEBPACK FOOTER //\n// ./src/init-throttled-xhr.js","var Shaper = function() {\n    var _maxBandwidth = Infinity;\n    var _minLatency = 0;\n    var _minProgressEvents = 0;\n    var _randomness = 0;\n\n    Object.defineProperty(this, \"maxBandwidth\", {\n        get: function() {\n            return Math.min(_maxBandwidth, Shaper.maxBandwidth);\n        },\n        set: function(val) { _maxBandwidth = val; }\n    });\n    Object.defineProperty(this, \"minLatency\", {\n        get: function() {\n            return Math.max(_minLatency, Shaper.minLatency);\n        },\n        set: function(val) { _minLatency = val; }\n    });\n    Object.defineProperty(this, \"minProgressEvents\", {\n        get: function() {\n            return Math.max(_minProgressEvents, Shaper.minProgressEvents);\n        },\n        set: function(val) { _minProgressEvents = val; }\n    });\n    Object.defineProperty(this, \"randomness\", {\n        get: function() {\n            return Math.max(_randomness, Shaper.randomness);\n        },\n        set: function(val) { _randomness = val; }\n    });\n};\n\nShaper.maxBandwidth = Infinity;\nShaper.minLatency = 0;\nShaper.minProgressEvents = 0;\nShaper.randomness = 0;\n\nmodule.exports = Shaper;\n\n\n// WEBPACK FOOTER //\n// ./src/shaper.js"],"sourceRoot":""}